CBLOCK
CONTA_2	
CONTA_1	 
BIT	
TECLA	 
LAST_TECLA
ENDC

CONVERT_HEX
	ADDWF PCL,F
	DT .5,.4,.3,.2,.1
	DT .6,.7,.8,.9,.10
	DT .11,.12,.13,.14,.15
	DT .16,.17,.18,.19,.20
	DT .21,.22,.23,.24,.25
END_CONVERT_HEX
	
RETARDO_20MS
	BANK0
	MOVLW .20
	MOVWF CONTA_2
	MOVLW .250
	MOVWF CONTA_1
	NOP
	DECFSZ CONTA_1,F
	GOTO $-.2
	DECFSZ CONTA_2,F
	GOTO $-.6
	RETURN 

READ_HEX
	CALL Teclado_LeeOrdenTecla
	BTFSS STATUS,C
	GOTO READ_HEX_END
	CALL CONVERT_HEX
	BSF STATUS,C
READ_HEX_END
	RETURN
;===============================================================================
	
TecladoInicializa
	BANK1
	MOVLW B'00000000'
	MOVWF TRISB
	MOVLW 0x0F
	MOVWF TRISC
	BANK0
	MOVLW .25
	MOVWF LAST_TECLA
	RETURN

Teclado_EsperaDejePulsar
	BANK0
	MOVLW 0x00
	MOVWF PORTB
Teclado_SigueEsperando
	CALL RETARDO_20MS
	MOVF PORTB,W
	SUBLW 0x00
	BTFSS STATUS,Z
	GOTO Teclado_SigueEsperando
	RETURN

Teclado_LeeOrdenTecla
	
	BANK0
	CLRF TECLA
	MOVLW B'11111110'
CHECK_ROW
	MOVWF PORTB
CHECK_COL_1
	BTFSS PORTC,0
	GOTO SAVE_VALUE
	INCF TECLA,F
CHECK_COL_2
	BTFSS PORTC,1
	GOTO SAVE_VALUE
	INCF TECLA,F
CHECK_COL_3
	BTFSS PORTC,2
	GOTO SAVE_VALUE
	INCF TECLA,F
CHECK_COL_4
	BTFSS PORTC,3
	GOTO SAVE_VALUE
	INCF TECLA,F
	
END_COL
	MOVLW LAST_TECLA
	SUBWF TECLA,W
	BTFSC STATUS,C
	GOTO TECLA_NO_PULSE
	BSF STATUS,C
	RLF PORTB,W
	GOTO CHECK_ROW
	
TECLA_NO_PULSE
	BCF STATUS,C
	GOTO KEYBOARD_END
SAVE_VALUE
	MOVF TECLA,W
	BSF STATUS,C
KEYBOARD_END
	RETURN